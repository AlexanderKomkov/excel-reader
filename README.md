# Excel-reader

Реализация небольшого читателя excel файлов в формате .xlsx, без использования готовых пакетов, с использованием ООП

## Установка и запуск локально

1. Создаем рабочую директорию и переходим в нее `mkdir ${app} && cd ${app}`
2. Клонируем репозиторий `git clone https://github.com/AlexanderKomkov/excel-reader.git ./`
3. Выполняем `composer install`
4. Запускаем докер `docker-compose up -d`

## Поблема с памятью

При чтении Excel файлов в формате .xlsx основной проблемой является то, как сохранить данные из файла `xl/sharedStrings.xml` так, чтобы не закончилась память, например из-за ограничений хостинга. Данные из этого файла, нужны при чтении каждого листа в Excel. Excel в целях оптимизации выносит все повторяющиеся значения ячеек в этот файл, а в самой ячейке указывает ссылку на значение.

## Решение 

По умолчанию Excel-reader хранит данные в свойстве класса `PropertyData`. Если Excel файл не большой, то этого будет достаточно. Если нужно читать очень большие прайс-листы, то можно написать свой класс с реализацией интерфейса `SharedData`.

Как вариант можно хранить данные в txt файле и перемещаться по нему используя функцию [fseek](https://www.php.net/manual/ru/function.fseek.php)


## Как использовать

```php
$priceList = dirname(__FILE__) . '/pricelists/price.xlsx';

$excelReader = new ExcelReader();

$excelReader->open($priceList);

foreach($excelReader->getSheets() as $sheet) {
    $sheet->reading(function($row, $cells) {
        echo '<pre>' . print_r($cells, true) . '</pre>';
        if ($row > 4) die();
    });
}

$excelReader->close();
```

## Результат print_r

```
Array
(
    [A] => MB
    [B] => 000000000530
    [C] => MB000000 000530_болт! М4.8\ MB
    [D] => 000000000530_MB
    [E] => 000000 000530
    [F] => 4
    [G] => 134.02
)
Array
(
    [A] => MB
    [B] => 000000001410
    [C] => MB000000001410_болт крепления защиты картера двигателя М8!\ MB
    [D] => 000000001410_MB
    [E] => 000000001410
    [F] => 5
    [G] => 188.44
)
Array
(
    [A] => MB
    [B] => 000000002102
    [C] => MB000000 002102_штифт успокоителя цепи ГРМ!\ MB
    [D] => 000000002102_MB
    [E] => 000000 002102
    [F] => 4
    [G] => 709.49
)
Array
(
    [A] => MB
    [B] => 000000004138
    [C] => MB000000004138_болт! Torx, М10\ MB
    [D] => 000000004138_MB
    [E] => 000000004138
    [F] => 5
    [G] => 1144.99
)
Array
(
    [A] => UAZ
    [B] => 000000035330097
    [C] => 000000035330097_шпилька специальная! М10х28\ УАЗ
    [D] => 00000003533009_UAZ
    [E] => 000000035330097
    [F] => 1
    [G] => 116.50
)
```